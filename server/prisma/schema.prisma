generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

enum Role {
  USER
  ADMIN
  DRIVER
}

enum UserType {
  HOUSEHOLD
  BUSINESS
}

enum UserStatus {
  ACTIVE
  INACTIVE
}

enum DriverStatus {
  ONLINE
  OFFLINE
  ON_PICKUP
}

enum BookingStatus {
  SCHEDULED
  COLLECTED
  PAID
  COMPLETED
  CANCELLED
  REFUNDED
}

enum NotificationLevel {
  INFO
  SUCCESS
  WARNING
  ERROR
}

enum PaymentMethod {
  MOBILE_WALLET
  BANK
}

enum PaymentStatus {
  PROCESSED
  FAILED
}

model User {
  id               String              @id @default(uuid())
  fullName         String
  email            String              @unique
  phone            String
  passwordHash     String
  refreshTokenHash String?
  role             Role                @default(USER)
  type             UserType            @default(HOUSEHOLD)
  address          String?
  status           UserStatus          @default(ACTIVE)
  createdAt        DateTime            @default(now())
  bookings         Booking[]
  notifications    Notification[]
}

model Driver {
  id          String       @id @default(uuid())
  name        String
  phone       String
  rating      Float        @default(4.6)
  pickupCount Int          @default(0)
  vehicleType String
  status      DriverStatus @default(OFFLINE)
  createdAt   DateTime     @default(now())
  bookings    Booking[]
}

model WasteCategory {
  id          String    @id @default(uuid())
  name        String    @unique
  description String?
  isActive    Boolean   @default(true)
  pricing     Pricing?
  bookings    Booking[]
}

model Pricing {
  id               String        @id @default(uuid())
  wasteCategoryId  String        @unique
  minPriceLkrPerKg Float
  maxPriceLkrPerKg Float
  updatedAt        DateTime      @updatedAt
  isActive         Boolean       @default(true)
  wasteCategory    WasteCategory @relation(fields: [wasteCategoryId], references: [id])
}

model Booking {
  id                   String        @id @default(uuid())
  userId               String
  wasteCategoryId      String
  estimatedWeightRange String
  estimatedMinAmount   Float
  estimatedMaxAmount   Float
  addressLine1         String
  city                 String
  postalCode           String
  specialInstructions  String?
  scheduledDate        DateTime
  scheduledTimeSlot    String
  status               BookingStatus @default(SCHEDULED)
  actualWeightKg       Float?
  finalAmountLkr       Float?
  driverId             String?
  createdAt            DateTime      @default(now())

  user          User          @relation(fields: [userId], references: [id])
  wasteCategory WasteCategory @relation(fields: [wasteCategoryId], references: [id])
  driver        Driver?       @relation(fields: [driverId], references: [id])
  transactions  PaymentTransaction[]
}

model Notification {
  id        String            @id @default(uuid())
  userId    String?
  title     String
  message   String
  level     NotificationLevel @default(INFO)
  isRead    Boolean           @default(false)
  createdAt DateTime          @default(now())

  user User? @relation(fields: [userId], references: [id])
}

model PaymentTransaction {
  id        String        @id @default(uuid())
  bookingId String
  amountLkr Float
  method    PaymentMethod
  status    PaymentStatus @default(PROCESSED)
  createdAt DateTime      @default(now())

  booking Booking @relation(fields: [bookingId], references: [id])
}

model LaunchNotify {
  id        String   @id @default(uuid())
  email     String   @unique
  createdAt DateTime @default(now())
}
